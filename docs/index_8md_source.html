<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>U.B.O.R: design/index.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">U.B.O.R
   </div>
   <div id="projectbrief">The [U]seless [B]ox [O]rganizing [R]obot. A FreeRTOS study project written in C which implements a multitasked control unit for a belt conveyor system with robotic sorting arms.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">design/index.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="index_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Documentation</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;## Configuration</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;There are mainly two configuration values:</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;* One is in the file `bcs.c`, the define [MAX_BLOCK_COUNT](@ref MAX_BLOCK_COUNT). Set this to the number of blocks you want to work with (between 2 and 4).</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;* The other configuration can happen at runtime. Use the DIP Switch 1, to switch between manaual and automatic direction choosing (for the dispatcher). Use the DIP Switch 2, to select the direction (left or right) in manual mode.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;## Starting of the model</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;After flashing the firmware to the carme, place [MAX_BLOCK_COUNT](@ref MAX_BLOCK_COUNT) onto the mid belt. One after each other, and always wait until one is moved away, before you place the next block.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;## File &amp; Module &amp; Task Description</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;| Module | Files  | Tasks | Description |</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;| ------|----- | ------- |---- |</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;| [ucan](@ref ucan)  | ucan.c, ucan.h | `CAN_Write_Task`, `CAN_Read_Task`, `CAN_Dispatch_Task` | Provides utilities to send and receive data from the CAN-Bus. Sending is done by calling the function `ucan_send_data`. To receive data, the modules can register themself using `ucan_link_message_to_queue`. |</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;| [display](@ref display)  | display.c, display.h | `Display Task` | Utilites to log stuff on the display. The function `display_log` can be used like printf (vargs!) and either logs your message to a new line in the log (together with the task name) or changes an existing line in the (scrolling) log. |</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;| [arm](@ref arm)  | arm.c, arm.h | `Arm Left`, `Arm Right`, `Manual Arm Movement`  | Controls the robot arms. The positions are stored in two fixed arrays. To manually move the arm (using the buttons and switches) the task `Manual Arm Movement`  can be uncommented. |</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;| [bcs](@ref bcs)  | bcs.c, bcs.h | `mid`, `left`, `right` | Controls the belt conveyer system and the dispatcher. Provides a set of functions which are used by the arm tasks for synchronization. |</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;| main | main.c | *none* | Calls the init function of all modules (which spawns the tasks) |</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;## Sequence Visualization</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;The following picture shows the situation where the block is (always) moved right. If both arms are active, the situation is similar. In Step 7 and Step 10 the mutex for the critial air zone is taken/released, to ensure a safe operation. </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;&lt;img src=&quot;./visual_steps.jpg&quot; width=&quot;500&quot;&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;The table below describes what functions are called in the steps. Check the activity/tasks diagramms below, to find out which semaphores/queues are used inside the functions.</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;| Step Nr | Task  | When | What |</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;| ------|----- | -------|---- |</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;| 1 | `mid` (belt) | Before moving the block | `bcs_await_drop(belt_mid)`  |</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;| 2 | `mid` (belt) | Before dispatching the block to the right band | `bcs_prepare_drop(belt_right)`  |</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;| 3 | `mid` (belt) | After dispatching the block to the right band | `bcs_signal_dropped(belt_right)`&lt;br&gt;`bcs_signal_band_free(belt_mid)` |</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;| 4 | `right` (belt) | Before moving the block |  `bcs_await_drop(belt_right)`  |</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;| 5 | `right` (belt) | When the block is ready for pickup |  `bcs_prepare_pickup(belt_right)`  |</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;| 6 | `Arm Right` | Before pickup |  `bcs_grab(belt_right)`&lt;br&gt;`bcs_signal_band_free(belt_right)`  |</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;| 7 | `Arm Right` | Before entering critial air zone|  `arm_enter_critical_air_space()`  |</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;| 8 | `Arm Right` | Before dropping block onto belt |  `bcs_prepare_drop(belt_mid)`  |</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;| 9 | `Arm Right` | After dropping block onto belt |  `bcs_signal_dropped(belt_mid)`  |</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;| 10 | `Arm Right` | After leaving the critical air zone |  `arm_leave_critical_air_space()`  |</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;## Activity Diagramm</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;Activity Diagram for the Situation where the block is moved right. The CAN communication is not shown in this diagram. The Focus lies on the communication between the arm/belt tasks.</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;&lt;img src=&quot;./Akitvitetsdiagram.png&quot; width=&quot;800&quot;&gt;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;The following Activity Diagramm shows the detailed process of the &quot;Move Block&quot; sequence. In this diagramm the focus lies on the CAN communication. The other action like &quot;Reset Dispatcher&quot;, &quot;Dispatch&quot; etc, wore in a similar way: They write stuff on the CAN-Bus by using a utility function that fills a queue. And they await a response to be put in their queue, by the CAN dispatcher task.</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;&lt;img src=&quot;./Akitvitetsdiagram_Move_Block.png&quot; width=&quot;800&quot;&gt;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;## Task Diagramms</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;In the following you find the tasks diagramms. These diagramms show all tasks and the commonly used resources (semaphores &amp; mutexes).</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;### Conveyer System and Belt Tasks</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;&lt;img src=&quot;./TaskDiagramm_Arm_Belt.png&quot; width=&quot;800&quot;&gt;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;### CAN Task</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;&lt;img src=&quot;./TaskDiagramm_CAN.png&quot; width=&quot;500&quot;&gt;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;### Display Task</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;&lt;img src=&quot;./TaskDiagramm_Display.png&quot; width=&quot;500&quot;&gt;</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>

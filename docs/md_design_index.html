<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>U.B.O.R: Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">U.B.O.R
   </div>
   <div id="projectbrief">The [U]seless [B]ox [O]rganizing [R]obot. A FreeRTOS study project written in C which implements a multitasked control unit for a belt conveyor system with robotic sorting arms.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Configuration</h2>
<p>There are mainly two configuration values:</p>
<ul>
<li>One is in the file <code><a class="el" href="bcs_8c.html">bcs.c</a></code>, the define <a class="el" href="group__bcs.html#gaf4832b48e562107b481016b88342a01a">MAX_BLOCK_COUNT</a>. Set this to the number of blocks you want to work with (between 2 and 4).</li>
<li>The other configuration can happen at runtime. Use the DIP Switch 1, to switch between manaual and automatic direction choosing (for the dispatcher). Use the DIP Switch 2, to select the direction (left or right) in manual mode.</li>
</ul>
<h2>Starting of the model</h2>
<p>After flashing the firmware to the carme, place <a class="el" href="group__bcs.html#gaf4832b48e562107b481016b88342a01a">MAX_BLOCK_COUNT</a> onto the mid belt. One after each other, and always wait until one is moved away, before you place the next block.</p>
<h2>File &amp; Module &amp; Task Description</h2>
<table class="doxtable">
<tr>
<th>Module </th><th>Files </th><th>Tasks </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="group__ucan.html">ucan</a> </td><td><a class="el" href="ucan_8c.html">ucan.c</a>, <a class="el" href="ucan_8h.html">ucan.h</a> </td><td><code>CAN_Write_Task</code>, <code>CAN_Read_Task</code>, <code>CAN_Dispatch_Task</code> </td><td>Provides utilities to send and receive data from the CAN-Bus. Sending is done by calling the function <code>ucan_send_data</code>. To receive data, the modules can register themself using <code>ucan_link_message_to_queue</code>. </td></tr>
<tr>
<td><a class="el" href="group__display.html">display</a> </td><td><a class="el" href="display_8c.html">display.c</a>, <a class="el" href="display_8h.html">display.h</a> </td><td><code>Display Task</code> </td><td>Utilites to log stuff on the display. The function <code>display_log</code> can be used like printf (vargs!) and either logs your message to a new line in the log (together with the task name) or changes an existing line in the (scrolling) log. </td></tr>
<tr>
<td><a class="el" href="group__arm.html">arm</a> </td><td><a class="el" href="arm_8c.html">arm.c</a>, <a class="el" href="arm_8h.html">arm.h</a> </td><td><code>Arm Left</code>, <code>Arm Right</code>, <code>Manual Arm Movement</code> </td><td>Controls the robot arms. The positions are stored in two fixed arrays. To manually move the arm (using the buttons and switches) the task <code>Manual Arm Movement</code> can be uncommented. </td></tr>
<tr>
<td><a class="el" href="group__bcs.html">bcs</a> </td><td><a class="el" href="bcs_8c.html">bcs.c</a>, <a class="el" href="bcs_8h.html">bcs.h</a> </td><td><code>mid</code>, <code>left</code>, <code>right</code> </td><td>Controls the belt conveyer system and the dispatcher. Provides a set of functions which are used by the arm tasks for synchronization. </td></tr>
<tr>
<td>main </td><td><a class="el" href="main_8c.html">main.c</a> </td><td><em>none</em> </td><td>Calls the init function of all modules (which spawns the tasks) </td></tr>
</table>
<h2>Sequence Visualization</h2>
<p>The following picture shows the situation where the block is (always) moved right. If both arms are active, the situation is similar. In Step 7 and Step 10 the mutex for the critial air zone is taken/released, to ensure a safe operation.</p>
<div class="image">
<img src="./visual_steps.jpg" width="500"/>
</div>
<p>The table below describes what functions are called in the steps. Check the activity/tasks diagramms below, to find out which semaphores/queues are used inside the functions.</p>
<table class="doxtable">
<tr>
<th>Step Nr </th><th>Task </th><th>When </th><th>What  </th></tr>
<tr>
<td>1 </td><td><code>mid</code> (belt) </td><td>Before moving the block </td><td><code>bcs_await_drop(belt_mid)</code> </td></tr>
<tr>
<td>2 </td><td><code>mid</code> (belt) </td><td>Before dispatching the block to the right band </td><td><code>bcs_prepare_drop(belt_right)</code> </td></tr>
<tr>
<td>3 </td><td><code>mid</code> (belt) </td><td>After dispatching the block to the right band </td><td><code>bcs_signal_dropped(belt_right)</code><br />
<code>bcs_signal_band_free(belt_mid)</code> </td></tr>
<tr>
<td>4 </td><td><code>right</code> (belt) </td><td>Before moving the block </td><td><code>bcs_await_drop(belt_right)</code> </td></tr>
<tr>
<td>5 </td><td><code>right</code> (belt) </td><td>When the block is ready for pickup </td><td><code>bcs_prepare_pickup(belt_right)</code> </td></tr>
<tr>
<td>6 </td><td><code>Arm Right</code> </td><td>Before pickup </td><td><code>bcs_grab(belt_right)</code><br />
<code>bcs_signal_band_free(belt_right)</code> </td></tr>
<tr>
<td>7 </td><td><code>Arm Right</code> </td><td>Before entering critial air zone</td><td><code>arm_enter_critical_air_space()</code> </td></tr>
<tr>
<td>8 </td><td><code>Arm Right</code> </td><td>Before dropping block onto belt </td><td><code>bcs_prepare_drop(belt_mid)</code> </td></tr>
<tr>
<td>9 </td><td><code>Arm Right</code> </td><td>After dropping block onto belt </td><td><code>bcs_signal_dropped(belt_mid)</code> </td></tr>
<tr>
<td>10 </td><td><code>Arm Right</code> </td><td>After leaving the critical air zone </td><td><code>arm_leave_critical_air_space()</code> </td></tr>
</table>
<h2>Activity Diagramm</h2>
<p>Activity Diagram for the Situation where the block is moved right. The CAN communication is not shown in this diagram. The Focus lies on the communication between the arm/belt tasks.</p>
<div class="image">
<img src="./Akitvitetsdiagram.png" width="800"/>
</div>
<p>The following Activity Diagramm shows the detailed process of the "Move Block" sequence. In this diagramm the focus lies on the CAN communication. The other action like "Reset Dispatcher", "Dispatch" etc, wore in a similar way: They write stuff on the CAN-Bus by using a utility function that fills a queue. And they await a response to be put in their queue, by the CAN dispatcher task.</p>
<div class="image">
<img src="./Akitvitetsdiagram_Move_Block.png" width="800"/>
</div>
<h2>Task Diagramms</h2>
<p>In the following you find the tasks diagramms. These diagramms show all tasks and the commonly used resources (semaphores &amp; mutexes).</p>
<h3>Conveyer System and Belt Tasks</h3>
<div class="image">
<img src="./TaskDiagramm_Arm_Belt.png" width="800"/>
</div>
<h3>CAN Task</h3>
<div class="image">
<img src="./TaskDiagramm_CAN.png" width="500"/>
</div>
<h3>Display Task</h3>
<div class="image">
<img src="./TaskDiagramm_Display.png" width="500"/>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
